import { execSync } from 'child_process'
import fs from 'fs'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

console.log('üöÄ –ü–æ—á–∏–Ω–∞—é –º—ñ–≥—Ä–∞—Ü—ñ—é –º–µ–¥—ñ–∞ –∑ S3 –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ...\n')

async function runMigration() {
  try {
    // –ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞ –∑ S3
    console.log('üì• –ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞ –∑ S3...')
    try {
      execSync('pnpm run download:media', { stdio: 'inherit' })
      console.log('‚úÖ –ú–µ–¥—ñ–∞ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ S3\n')
    } catch (error) {
      console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞:', error.message)
      console.log('‚ö†Ô∏è  –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è S3 —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É')
      return
    }

    // –ö—Ä–æ–∫ 2: –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è localStorage (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–±—É–¥–æ–≤–∞–Ω–µ)
    console.log('üì¶ –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä—è—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è...')
    console.log('‚úÖ Payload –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞\n')

    // –ö—Ä–æ–∫ 3: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Payload
    console.log('‚öôÔ∏è  –ö—Ä–æ–∫ 3: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Payload...')
    try {
      execSync('pnpm run update:config', { stdio: 'inherit' })
      console.log('‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Payload –æ–Ω–æ–≤–ª–µ–Ω–∞\n')
    } catch (error) {
      console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:', error.message)
      return
    }

    // –ö—Ä–æ–∫ 4: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ –º–µ–¥—ñ–∞ –≤ –∫–æ–¥—ñ
    console.log('üîó –ö—Ä–æ–∫ 4: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ –º–µ–¥—ñ–∞ –≤ –∫–æ–¥—ñ...')
    try {
      execSync('pnpm run update:references', { stdio: 'inherit' })
      console.log('‚úÖ –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–µ–¥—ñ–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ\n')
    } catch (error) {
      console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å:', error.message)
      return
    }

    console.log('üéâ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!\n')
    console.log('üìã –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:')
    console.log('1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä —Ä–æ–∑—Ä–æ–±–∫–∏')
    console.log('2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—Å—ñ –º–µ–¥—ñ–∞ —Ñ–∞–π–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è')
    console.log('3. –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å–∞–π—Ç—É')
    console.log('4. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤—Å—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è')

    console.log('\n‚ö†Ô∏è  –í–∞–∂–ª–∏–≤–æ:')
    console.log('- –†–µ–∑–µ—Ä–≤–Ω–∞ –∫–æ–ø—ñ—è payload.config.ts –∑–±–µ—Ä–µ–∂–µ–Ω–∞ —è–∫ payload.config.ts.backup')
    console.log('- –í—Å—ñ –º–µ–¥—ñ–∞ —Ñ–∞–π–ª–∏ —Ç–µ–ø–µ—Ä –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ public/media/')
    console.log('- –Ø–∫—â–æ —â–æ—Å—å –ø—ñ–¥–µ –Ω–µ —Ç–∞–∫, –º–æ–∂–µ—Ç–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ S3, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é')
  } catch (error) {
    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –º—ñ–≥—Ä–∞—Ü—ñ—ó:', error)
  }
}

// –ó–∞–ø—É—Å–∫–∞—î–º–æ –º—ñ–≥—Ä–∞—Ü—ñ—é
runMigration()
